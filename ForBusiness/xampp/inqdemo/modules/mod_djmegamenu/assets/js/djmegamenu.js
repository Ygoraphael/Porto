/**
 * @version $Id: djmegamenu.js 37 2015-05-26 14:23:53Z szymon $
 * @package DJ-MegaMenu
 * @copyright Copyright (C) 2013 DJ-Extensions.com, All rights reserved.
 * @license DJ-Extensions.com Proprietary Use License
 * @author url: http://dj-extensions.com
 * @author email contact@dj-extensions.com
 * @developer Szymon Woronowski - szymon.woronowski@design-joomla.eu
 */
(function($){var j=function(a,b){this.options={delay:500,animIn:'fadeIn',animOut:'fadeOut',animSpeed:'normal',duration:450,wrap:null,direction:'ltr',event:'mouseenter',touch:(('ontouchstart'in window)||(navigator.MaxTouchPoints>0)||(navigator.msMaxTouchPoints>0)),offset:0};this.init(a,b)};j.prototype.init=function(c,d){var f=this;f.options=Object.merge(f.options,d);if(!c)return;switch(f.options.animSpeed){case'fast':f.options.duration=250;break;case'slow':f.options.duration=650;break}c.addClass(f.options.animSpeed);var g=c.getChildren('li.dj-up');f.kids=[];if(!f.options.wrap)f.options.wrap=c;else f.options.wrap=$(f.options.wrap);if(f.options.touch)c.addEvent('touchstart',function(e){e.stopPropagation()});g.each(function(a,b){f.kids[b]=new k(a,0,f,f.options)});if(f.options.fixed==1&&!f.options.touch){window.addEvent('load',f.makeSticky.bind(f,c))}};j.prototype.makeSticky=function(a){var b=this;b.sticky=false;var c=new Element('div',{id:a.get('id')+'sticky'});c.addClass('dj-megamenu');c.addClass('dj-megamenu-'+b.options.theme);c.addClass('dj-megamenu-sticky');c.setStyles({position:'fixed',top:parseInt(b.options.offset),left:0,width:'100%',display:'none'});c.inject(a,'after');var d=$(a.get('id')+'stickylogo');if(d){d.inject(c);d.setStyle('display','block')}var e=a.getPosition().y-parseInt(b.options.offset);var f=a.clone(true);f.set('id',a.get('id')+'placeholder');f.setStyles({display:'none',opacity:0});f.inject(a,'before');var g=b.options.direction=='rtl'?'right':'left';window.addEvent('scroll',b.scroll.bind(b,c,a,f,e,g,false));window.addEvent('resize',b.scroll.bind(b,c,a,f,e,g,true))};j.prototype.scroll=function(a,b,c,d,e,f){var g=this;if(window.getScroll().y>d){if(!g.sticky){var h=b.getCoordinates();var i=e=='left'?h.left:window.getSize().x-h.left-h.width;b.setStyle(e,i);c.setStyle('display','');a.setStyle('display','');b.inject(a);g.sticky=true}else if(f){var h=c.getCoordinates();var i=e=='left'?h.left:window.getSize().x-h.left-h.width;b.setStyle(e,i)}}else if(g.sticky){a.setStyle('display','none');c.setStyle('display','none');b.inject(c,'after');b.setStyle(e,'');g.sticky=false}};var k=function(a,b,c,d){this.options={};this.init(a,b,c,d)};k.prototype.init=function(a,b,c,d){var f=this;f.options=Object.merge(f.options,d);f.menu=a;f.level=b;f.parent=c;f.timer=null;f.sub=f.menu.getElement('> .dj-subwrap');var g='mouseenter';if(f.options.touch||f.options.event=='click_all'){g=f.options.touch?g:'click';var h=f.menu.getElement('> a');if(h){if(f.menu.hasClass('separator'))h.setStyle('cursor','pointer');function checkAnchor(e){if(f.sub&&!f.menu.hasClass('hover')){e.preventDefault();if(e.type=='touchend')f.menu.fireEvent('click')}};if(f.options.touch)h.addEvent('touchend',checkAnchor);h.addEvent('click',checkAnchor)}}else if(f.options.event=='click'&&f.menu.hasClass('separator')){var h=f.menu.getElement('> a');if(h)h.setStyle('cursor','pointer');g='click'}if(f.options.touch){f.menu.addEvent('click',f.showSub.bind(f));$(document).addEvent('touchstart',function(){if(f.menu.hasClass('hover'))f.menu.fireEvent('mouseleave')})}f.menu.addEvent(g,f.showSub.bind(f));f.menu.addEvent('mouseleave',f.hideSub.bind(f));if(f.sub){f.kids=[];f.initKids()}};k.prototype.showSub=function(){var a=this;clearTimeout(a.timer);if(a.menu.hasClass('hover')&&!a.sub.hasClass(a.options.animOut)){return}clearTimeout(a.animTimer);a.menu.addClass('hover');a.hideOther();if(a.sub){a.sub.removeClass(a.options.animOut);a.checkDir();a.sub.addClass(a.options.animIn)}};k.prototype.hideSub=function(){var a=this;if(a.sub){a.timer=setTimeout(function(){a.sub.removeClass(a.options.animIn);a.sub.addClass(a.options.animOut);a.animTimer=setTimeout(function(){a.menu.removeClass('hover')},a.options.duration)},a.options.delay)}else{a.menu.removeClass('hover')}};k.prototype.checkDir=function(){var a=this;a.DirDone=true;var b=a.sub.getCoordinates();var c=a.options.wrap.getCoordinates();if(a.options.wrap.hasClass('dj-megamenu')){var d=$(a.options.wrap.get('id')+'placeholder');if(d&&a.options.wrap.getElement('.dj-megamenu'))c=d.getCoordinates()}a.sub.setStyle('left','');a.sub.setStyle('right','');a.sub.setStyle('margin-left','');a.sub.setStyle('margin-right','');if(a.options.direction=='ltr'){var e=b.left+b.width-c.width-c.left;if(e>0||a.sub.hasClass('open-left')){if(a.level){a.sub.setStyle('right',a.menu.getSize().x);a.sub.setStyle('left','auto')}else{if(a.sub.hasClass('open-left')){a.sub.setStyle('right',a.menu.getStyle('left'));a.sub.setStyle('left','auto')}else{a.sub.setStyle('margin-left',-e)}}}}else if(a.options.direction=='rtl'){var e=b.left-c.left;if(e<0||a.sub.hasClass('open-right')){if(a.level){a.sub.setStyle('left',a.menu.getSize().x);a.sub.setStyle('right','auto')}else{if(a.sub.hasClass('open-right')){a.sub.setStyle('left',a.menu.getStyle('right'));a.sub.setStyle('right','auto')}else{a.sub.setStyle('margin-right',e)}}}}};k.prototype.initKids=function(){var c=this;var d=c.sub.getChildren('.dj-subwrap-in > .dj-subcol > ul.dj-submenu > li');d.each(function(a,b){c.kids[b]=new k(a,c.level+1,c,c.options)})};k.prototype.hideOther=function(){var b=this;b.parent.kids.each(function(a){if(a.menu.hasClass('hover')&&a!=b){if(a.sub){a.hideOtherSub();a.sub.removeClass(a.options.animIn);a.sub.addClass(a.options.animOut);a.animTimer=setTimeout(function(){a.menu.removeClass('hover')},b.options.duration)}else{a.menu.removeClass('hover')}}})};k.prototype.hideOtherSub=function(){var b=this;b.kids.each(function(a){if(a.sub){a.hideOtherSub();a.sub.removeClass(a.options.animIn);a.sub.removeClass(a.options.animOut)}a.menu.removeClass('hover')})};window.addEvent('domready',function(){$$('.dj-megamenu[data-options]').each(function(a){a.getElements('.dj-hideitem').destroy();var b=JSON.decode(a.getProperty('data-options'));a.removeProperty('data-options');new j(a,b)})})})(document.id);