package fme;

import java.util.Vector;
import javax.swing.JComboBox;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextArea;

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































class CBTabela_DominiosPrioritarios
  extends CBTabela
{
  Frame_CriteriosSelecao3 P;
  JComboBox cbo_areas;
  
  public String getPagina()
  {
    return "CriteriosSelecao3";
  }
  



  int detalhe = -1;
  int limite = 9000;
  
  CBTabela_DominiosPrioritarios() {
    P = ((Frame_CriteriosSelecao3)fmeApp.Paginas.getPage("CriteriosSelecao3"));
    if (P == null) return;
    initialize();
  }
  
  void initialize() {
    tag = "DominiosPrioritarios";
    started = true;
    force_xml = true;
    
    cols = new CHTabColModel[6];
    cols[0] = new CHTabColModel("n_ordem", "Nº", true, false, true, null);
    cols[1] = new CHTabColModel("dominio", "", true, false, false, null);
    cols[2] = new CHTabColModel("dominio_d", "Domínio Prioritário", false, true, true, null);
    cols[3] = new CHTabColModel("area", "", true, false, false, null);
    cols[4] = new CHTabColModel("area_d", "Principal Área de Atuação", false, true, true, null);
    cols[5] = new CHTabColModel("justificacao", "Justificação", true, false, true, null);
    
    init_dados(7);
    

    init_handler(P.jTable_Dominios);
    P.jTable_Dominios.addKeyListener(new TableKeyListener(this));
    handler.width = P.jScrollPane_Dominios.getWidth();
    
    handler.set_col_text(0, 0.05D, "C");
    handler.set_col_comboS(2, 0.3D, null, CTabelas.ENEIDominio, 1, 550);
    cbo_areas = handler.set_col_comboF(4, 0.3D, null, null, 1, 550);
    handler.set_col_text(5, 0.345D, null);
    
    set_detalhe();
  }
  

  void _filter_populate_areas(SteppedComboBox cbo_areas, int row)
  {
    String dominio = getColValue("dominio", row);
    String area = getColValue("area", row);
    
    if (dominio.length() == 0) {
      cbo_areas.removeAllItems();
    } else {
      CTabelas.ENEIAreaF1.set_filter(2, dominio);
      CTabelas.ENEIAreaF1._populateComboBox(cbo_areas);
    }
    if (area.length() > 0) {
      int n = CTabelas.ENEIAreaF1.getIndexFromCode(area);
      if (n >= 0) cbo_areas.setSelectedIndex(n + 1);
    }
  }
  
  void on_update(String colname, int nRow, String v) {
    numerar(0);
    if (colname.equals("area_d")) {
      String area = "";
      String dominio_old = getColValue("dominio_d", nRow);
      if (v.length() > 0) {
        area = CTabelas.ENEIAreaF1.lookup(1, v, 0);
        String dominio_d = CTabelas.ENEIDominio.lookup(0, area.substring(0, 2), 1);
        if (!dominio_old.equals(dominio_d))
          setColValue("dominio_d", nRow, "");
      }
      setColValue("area", nRow, area);
    }
    if (colname.equals("area")) {
      String area_d = "";
      if (v.length() > 0) area_d = CTabelas.ENEIArea.lookup(0, v, 1);
      setColValue("area_d", nRow, area_d);
    }
    
    if (colname.equals("dominio_d")) {
      String dominio = "";
      String dominio_old = "";
      if (getColValue("area", nRow).length() > 0)
        dominio_old = getColValue("area", nRow).substring(0, 2);
      if (v.length() == 0) {
        on_update("area_d", nRow, "");
        setColValue("area_d", nRow, "");
      }
      else {
        dominio = CTabelas.ENEIDominio.lookup(1, v, 0);
        if (!dominio_old.equals(dominio)) {
          on_update("area_d", nRow, "");
          setColValue("area_d", nRow, "");
        }
      }
      setColValue("dominio", nRow, dominio);
    }
    if (colname.equals("dominio")) {
      String dominio_d = "";
      if (v.length() > 0)
        dominio_d = CTabelas.ENEIDominio.lookup(0, v, 1);
      setColValue("dominio_d", nRow, dominio_d);
      on_update("dominio_d", nRow, dominio_d);
    }
    handler.j.repaint();
    if ((!CBData.reading_xml) && (!CBData.clear_pg)) {
      after_update();
    }
  }
  
  public void set_detalhe() {
    int nRow = P.jTable_Dominios.getSelectedRow();
    if ((nRow >= 0) && (nRow < P.jTable_Dominios.getRowCount())) {
      P.setDescricao_Dominios(getColValue("n_ordem", nRow));
    } else {
      P.setDescricao_Dominios("");
    }
  }
  
  public void after_update() {
    set_detalhe();
    
    handler.j.repaint();
  }
  

  void on_current_row() { on_row(P.jTable_Dominios.getSelectedRow()); }
  
  void on_row(int nRow) {
    if (nRow != detalhe) altera_detalhe(nRow);
    CBData.DadosDominioPrioritario.on_update2();
  }
  
  void altera_detalhe(int nRow) { if ((nRow >= 0) && (nRow < P.jTable_Dominios.getRowCount())) {
      P.getjTextArea_Dominios_Txt().setText(getColValue("justificacao", nRow));
    } else {
      P.getjTextArea_Dominios_Txt().setText("");
    }
    detalhe = nRow;
    after_update();
  }
  
  public boolean on_ins_row() {
    altera_detalhe(-1);
    if (super.on_ins_row()) {
      on_current_row();
      return true;
    }
    return false;
  }
  
  public boolean on_add_row() {
    altera_detalhe(-1);
    if (super.on_add_row()) {
      on_current_row();
      return true;
    }
    return false;
  }
  
  public boolean on_del_row() {
    altera_detalhe(-1);
    if (super.on_del_row()) {
      on_current_row();
      return true;
    }
    return false;
  }
  
  String on_xml(String tag, int row, String v) {
    String s = "";
    if (tag.equals("dominio"))
      s = s + _lib.xml_encode("dominio_d", getColValue("dominio_d", row));
    if (tag.equals("area"))
      s = s + _lib.xml_encode("area_d", getColValue("area_d", row));
    return s;
  }
  
  CHValid_Grp validar(CHValid_Grp err_list) {
    if (err_list == null) {
      err_list = new CHValid_Grp(this, "C1. Domínios Prioritários");
    }
    


    for (int j = 0; j < dados.size(); j++) {
      String mask = "R-R-RR";
      TabError[] e = isIncompletAll(j, mask.toString());
      for (int ii = 0; (e != null) && (ii < e.length); ii++)
        err_list.add_msg(new CHValid_Msg("incomplet", e[ii].msg("Linha %L incompleta: %T - %o")));
    }
    return err_list;
  }
}
