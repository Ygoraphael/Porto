package fme;

import java.io.PrintStream;
import java.util.Vector;
import javax.swing.JComboBox;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.JTextArea;






























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































class CBTabela_DesafiosSocietais
  extends CBTabela
{
  Frame_CriteriosSelecao3 P;
  JComboBox cbo_linhas;
  
  public String getPagina()
  {
    return "CriteriosSelecao3";
  }
  



  int detalhe = -1;
  int limite = 9000;
  
  CBTabela_DesafiosSocietais() {
    P = ((Frame_CriteriosSelecao3)fmeApp.Paginas.getPage("CriteriosSelecao3"));
    if (P == null) return;
    initialize();
  }
  
  void initialize() {
    tag = "DesafiosSocietais";
    started = true;
    force_xml = true;
    
    cols = new CHTabColModel[6];
    cols[0] = new CHTabColModel("n_ordem", "Nº", true, false, true, null);
    cols[1] = new CHTabColModel("desafio", "", true, false, false, null);
    cols[2] = new CHTabColModel("desafio_d", "Desafio Societal", false, true, true, null);
    cols[3] = new CHTabColModel("linha", "", true, false, false, null);
    cols[4] = new CHTabColModel("linha_d", "Principal Linha de Atuação", false, true, true, null);
    cols[5] = new CHTabColModel("justificacao", "Justificação", true, false, true, null);
    
    init_dados(7);
    

    init_handler(P.jTable_Desafios);
    P.jTable_Desafios.addKeyListener(new TableKeyListener(this));
    handler.width = P.jScrollPane_Desafios.getWidth();
    
    handler.set_col_text(0, 0.05D, "C");
    handler.set_col_comboS(2, 0.3D, null, CTabelas.DesafiosSocietais, 1, 550);
    cbo_linhas = handler.set_col_comboF(4, 0.3D, null, null, 1, 550);
    handler.set_col_text(5, 0.345D, null);
  }
  

  void _filter_populate_linhas(SteppedComboBox cbo_linhas, int row)
  {
    String desafio = getColValue("desafio", row);
    String linha = getColValue("linha", row);
    
    if (desafio.length() == 0) {
      cbo_linhas.removeAllItems();
    } else {
      CTabelas.LinhasAtuacaoF1.set_filter(2, desafio);
      CTabelas.LinhasAtuacaoF1._populateComboBox(cbo_linhas);
    }
    if (linha.length() > 0) {
      int n = CTabelas.LinhasAtuacaoF1.getIndexFromCode(linha);
      if (n >= 0) cbo_linhas.setSelectedIndex(n + 1);
    }
  }
  
  void on_update(String colname, int nRow, String v) {
    numerar(0);
    if (colname.equals("linha_d")) {
      String linha = "";
      String desafio_old = getColValue("desafio_d", nRow);
      if (v.length() > 0) {
        linha = CTabelas.LinhasAtuacaoF1.lookup(1, v, 0);
        String desafio_d = CTabelas.DesafiosSocietais.lookup(0, linha.substring(0, 1), 1);
        if (!desafio_old.equals(desafio_d))
          setColValue("desafio_d", nRow, "");
      }
      setColValue("linha", nRow, linha);
    }
    if (colname.equals("linha")) {
      String linha_d = "";
      if (v.length() > 0) linha_d = CTabelas.LinhasAtuacao.lookup(0, v, 1);
      setColValue("linha_d", nRow, linha_d);
    }
    
    if (colname.equals("desafio_d")) {
      String desafio = "";
      String desafio_old = "";
      if (getColValue("linha", nRow).length() > 0)
        desafio_old = getColValue("linha", nRow).substring(0, 1);
      if (v.length() == 0) {
        on_update("linha_d", nRow, "");
        setColValue("linha_d", nRow, "");
      }
      else {
        desafio = CTabelas.DesafiosSocietais.lookup(1, v, 0);
        if (!desafio_old.equals(desafio)) {
          on_update("linha_d", nRow, "");
          setColValue("linha_d", nRow, "");
        }
      }
      setColValue("desafio", nRow, desafio);
    }
    if (colname.equals("desafio")) {
      String desafio_d = "";
      if (v.length() > 0)
        desafio_d = CTabelas.DesafiosSocietais.lookup(0, v, 1);
      setColValue("desafio_d", nRow, desafio_d);
      on_update("desafio_d", nRow, desafio_d);
    }
    if ((!CBData.reading_xml) && (!CBData.clear_pg)) {
      after_update();
    }
    handler.j.repaint();
  }
  
  public void set_detalhe() {
    int nRow = P.jTable_Desafios.getSelectedRow();
    if ((nRow >= 0) && (nRow < P.jTable_Desafios.getRowCount())) {
      P.setDescricao_Desafios(getColValue("n_ordem", nRow));
    } else {
      P.setDescricao_Desafios("");
    }
  }
  
  public void after_update() {
    set_detalhe();
    
    handler.j.repaint();
  }
  

  void on_current_row() { on_row(P.jTable_Desafios.getSelectedRow()); }
  
  void on_row(int nRow) {
    if (nRow != detalhe) altera_detalhe(nRow);
    CBData.DadosDesafioSocietal.on_update2();
  }
  
  void altera_detalhe(int nRow) { System.out.println("nrow " + nRow);
    if ((nRow >= 0) && (nRow < P.jTable_Desafios.getRowCount())) {
      P.getjTextArea_Desafios_Txt().setText(getColValue("justificacao", nRow));
    } else {
      P.getjTextArea_Desafios_Txt().setText("");
    }
    detalhe = nRow;
    after_update();
  }
  
  public boolean on_ins_row() {
    altera_detalhe(-1);
    if (super.on_ins_row()) {
      on_current_row();
      return true;
    }
    return false;
  }
  
  public boolean on_add_row() {
    altera_detalhe(-1);
    if (super.on_add_row()) {
      on_current_row();
      return true;
    }
    return false;
  }
  
  public boolean on_del_row() {
    altera_detalhe(-1);
    if (super.on_del_row()) {
      on_current_row();
      return true;
    }
    return false;
  }
  
  String on_xml(String tag, int row, String v) {
    String s = "";
    if (tag.equals("desafio"))
      s = s + _lib.xml_encode("desafio_d", getColValue("desafio_d", row));
    if (tag.equals("linha"))
      s = s + _lib.xml_encode("linha_d", getColValue("linha_d", row));
    return s;
  }
  
  CHValid_Grp validar(CHValid_Grp err_list) {
    if (err_list == null) {
      err_list = new CHValid_Grp(this, "C2. Desafios Societais");
    }
    


    for (int j = 0; j < dados.size(); j++) {
      String mask = "R-R-RR";
      TabError[] e = isIncompletAll(j, mask.toString());
      for (int ii = 0; (e != null) && (ii < e.length); ii++)
        err_list.add_msg(new CHValid_Msg("incomplet", e[ii].msg("Linha %L incompleta: %T - %o")));
    }
    return err_list;
  }
}
