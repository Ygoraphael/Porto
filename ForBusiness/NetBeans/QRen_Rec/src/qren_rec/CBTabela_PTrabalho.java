package fme;

import java.util.Vector;
import javax.swing.JScrollPane;
import javax.swing.JTable;
import javax.swing.table.JTableHeader;





























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































class CBTabela_PTrabalho
  extends CBTabela
{
  Frame_IdProm_3 P12;
  
  public String getPagina()
  {
    return "PTrabalho";
  }
  

  int tab_index = 0;
  int n_anos = 1;
  
  CBTabela_PTrabalho() {
    P12 = ((Frame_IdProm_3)fmeApp.Paginas.getPage("IdProm_3"));
    if (P12 == null) return;
    initialize();
  }
  
  CBTabela_PTrabalho(Frame_IdProm_3 p, int idx) {
    P12 = p;
    tab_index = idx;
    initialize();
  }
  
  void initialize() {
    tag = "PTrabalho";
    started = true;
    P12.cbd_ptrabalho = this;
    
    cols = new CHTabColModel[10];
    cols[0] = new CHTabColModel("area", "Área Funcional (id)", true, true, false, null);
    cols[1] = new CHTabColModel("area_d", "Área Funcional", false, true, true, null);
    cols[2] = new CHTabColModel("nivel", "Nível (id)", true, true, false, null);
    cols[3] = new CHTabColModel("nivel_d", "Nível de<br>Qualificação", false, true, true, null);
    cols[4] = new CHTabColModel("val_m_pre", "Ano<br>Pré-Proj. Mulheres", true, true, true, CFLib.VLD_NUM_0);
    cols[5] = new CHTabColModel("val_h_pre", "Ano<br>Pré-Proj. Homens", true, true, true, CFLib.VLD_NUM_0);
    cols[6] = new CHTabColModel("val_tt_pre", "Ano<br>Pré-Proj. Total", true, false, true, CFLib.VLD_NUM_0);
    cols[7] = new CHTabColModel("val_m_pos", "Ano<br>Pós-Proj. Mulheres", true, true, true, CFLib.VLD_NUM_0);
    cols[8] = new CHTabColModel("val_h_pos", "Ano<br>Pós-Proj. Homens", true, true, true, CFLib.VLD_NUM_0);
    cols[9] = new CHTabColModel("val_tt_pos", "Ano<br>Pós-Proj. Total", true, false, true, CFLib.VLD_NUM_0);
    
    init_dados(13);
    

    init_handler(P12.getJTable_PTrabalho());
    P12.getJTable_PTrabalho().addKeyListener(new TableKeyListener(this));
    handler.width = P12.getJScrollPane_PTrabalho().getWidth();
    
    ui = new GroupableTableHeaderUI();
    ui.setH(2, P12.getJTable_PTrabalho());
    
    ui.add_col(0, 0, 1, 2, "Área Funcional");
    ui.add_col(1, 0, 1, 2, "<html><div align='center'>Nível de<br>Qualificação</div></html>");
    ui.add_col(2, 0, 3, 1, "Ano Pré-Proj.");
    ui.add_col(2, 1, 1, 1, "Mulheres");
    ui.add_col(3, 1, 1, 1, "Homens");
    ui.add_col(4, 1, 1, 1, "Total");
    ui.add_col(5, 0, 3, 1, "Ano Pós-Proj.");
    ui.add_col(5, 1, 1, 1, "Mulheres");
    ui.add_col(6, 1, 1, 1, "Homens");
    ui.add_col(7, 1, 1, 1, "Total");
    
    P12.getJTable_PTrabalho().getTableHeader().setUI(ui);
    
    handler.set_col_comboS(1, 0.33D, null, CTabelas.AreasFunc, 1, 250);
    handler.set_col_comboS(3, 0.11D, null, CTabelas.NiveisQual, 1, 80);
    handler.set_col_text(4, 0.09D, "R");
    handler.set_col_text(5, 0.09D, "R");
    handler.set_col_text(6, 0.09D, "R");
    handler.set_col_text(7, 0.09D, "R");
    handler.set_col_text(8, 0.09D, "R");
    handler.set_col_text(9, 0.09D, "R");
  }
  





  void on_update(String colname, int nRow, String v)
  {
    if (colname.equals("area_d")) {
      String area = "";
      if (v.length() > 0) area = CTabelas.AreasFunc.lookup(1, v, 0);
      setColValue("area", nRow, area);
    }
    if (colname.equals("area")) {
      String area_d = "";
      if (v.length() > 0) area_d = CTabelas.AreasFunc.lookup(0, v, 1);
      setColValue("area_d", nRow, area_d);
    }
    
    if (colname.equals("nivel_d")) {
      String nivel = "";
      if (v.length() > 0) nivel = CTabelas.NiveisQual.lookup(1, v, 0);
      setColValue("nivel", nRow, nivel);
    }
    if (colname.equals("nivel")) {
      String nivel_d = "";
      if (v.length() > 0) nivel_d = CTabelas.NiveisQual.lookup(0, v, 1);
      setColValue("nivel_d", nRow, nivel_d);
    }
    if ((colname.startsWith("val_m_")) || (colname.startsWith("val_h_"))) {
      String suffix = colname.substring(colname.lastIndexOf("_") + 1);
      int m = _lib.to_int(getColValue("val_m_" + suffix, nRow));
      int h = _lib.to_int(getColValue("val_h_" + suffix, nRow));
      int tt = m + h;
      if (tt == 0) {
        setColValue("val_tt_" + suffix, nRow, "");
      } else {
        setColValue("val_tt_" + suffix, nRow, tt);
      }
    }
  }
  




















































  String on_xml(String tag, int row, String v)
  {
    String s = "";
    if (tag.equals("area"))
      s = s + _lib.xml_encode("area_d", getColValue("area_d", row));
    if (tag.equals("nivel"))
      s = s + _lib.xml_encode("nivel_d", getColValue("nivel_d", row));
    return s;
  }
  
  CHValid_Grp validar(CHValid_Grp err_list, String cp) {
    String titulo = "Postos de Trabalho do Beneficiário";
    if (cp.length() > 0) { titulo = titulo + cp;
    }
    if (err_list == null)
      err_list = new CHValid_Grp(this, titulo);
    if (!started) { return err_list;
    }
    
    if ((isEmpty()) && (tab_index == 0) && (!PromotorgetByName"nat_jur"v.equals("10"))) {
      err_list.add_msg(new CHValid_Msg("ptrabalho", "Lista vazia"));
    }
    int ano_cand = (int)CBData.Params.getByName("ano_cand").valueAsDouble();
    int ano_inicial = ano_cand;
    



    String v = PromotorgetByName"dt_inicio_act"v;
    if (v.length() == 10) {
      ano_inicial = Integer.parseInt(v.substring(0, 4));
    }
    int idx_i = 4 - (ano_cand - ano_inicial - 1) * 3;
    if (idx_i < 0) { idx_i = 0;
    }
    for (int j = 0; j < dados.size(); j++) {
      String mask = "-R-R------";
      
      TabError[] e = isIncompletAll(j, mask.toString());
      for (int ii = 0; (e != null) && (ii < e.length); ii++) {
        err_list.add_msg(new CHValid_Msg("incomplet", e[ii].msg("Linha %L incompleta: %T - %o")));
      }
      if (!isRowEmpty(j))
        for (int i = 4; i <= 9; i++) {
          String ano_s = cols[i].col_name;
          String tag = cols[i].col_tag;
          if ((i != 6) && (i != 9)) {
            String s = ((String[])dados.elementAt(j))[i];
            if (((i < 6) && (i >= idx_i) && (s.length() == 0)) || ((i > 6) && (s.length() == 0))) {
              String _msg = "Linha " + (j + 1) + " incompleta: " + ano_s + " - %o";
              _msg = _msg.replaceAll("\n", " ");
              _msg = _msg.replaceAll("<br>", " ");
              _msg = _msg.replaceAll("<html>", "");
              _msg = _msg.replaceAll("</html>", "");
              _msg = _msg.replaceAll("<div align='center'>", "");
              _msg = _msg.replaceAll("</div>", "");
              
              err_list.add_msg(new CHValid_Msg("ptrabalho", _msg));
            }
          }
        }
    }
    return err_list;
  }
}
