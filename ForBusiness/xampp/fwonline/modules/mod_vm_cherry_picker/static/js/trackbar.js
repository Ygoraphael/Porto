var trackbarActive=false;var currentHoverParameter=null;var cpTrackbar=new Class({_isInitialized:0,options:{mode:0,form:null,trackbar:null,inputLeft:null,inputRight:null,label:null,values:null,decimals:0,step:null,limitLeft:0,limitRight:100,valueLeft:null,valueRight:null,infoLabels:null,showApplyButton:false,delimeter:":",optimizeFPS:true,extremumValueToNull:1},initialize:function(_1){this.setOptions(_1);this.bound={"start":this.start.bindWithEvent(this),"drag":this.drag.bindWithEvent(this),"stop":this.stop.bind(this),"update":this.update.bind(this),"set":this.set.bindWithEvent(this)};var _2=this;var _3=this.options.trackbar;var _4=this.options.groupName+"_ToggleDidBeginEvent";document.id(_3).removeClass("hid");window.addEvent("domready",function(){if(_3.offsetWidth){_2.initTrackbar();_2.setInitialized(true);}else{window.addEventListener(_4,function toggleEventHandler(_5){if(!_2.isInitialized()&&_3.offsetWidth){_2.initTrackbar();_2.setInitialized(true);window.removeEventListener(_4,_6);}});}});},isInitialized:function(){return this._isInitialized;},setInitialized:function(_7){this._isInitialized=_7;},initTrackbar:function(){var _8,tb,w,sl,_9,sr,_a,_b,_c;_8=this.options.mode;if(_8==1){this.options.values.splice(0,0,"");if(this.options.valueLeft!==null){this.options.valueLeft++;}this.options.limitRight++;}tb=this.options.trackbar;this.trackbarElement=tb;w=tb.offsetWidth;this.trackbarWidth=w;sliderLeft=tb.getElement(".left-slider");this.sliderLeft=sliderLeft;sliderLeft.addEvent("mousedown",this.bound.start);_9=sliderLeft.offsetWidth;this.sliderLeftWidth=_9;if(_8!=1){sliderRight=tb.getElement(".right-slider");this.sliderRight=sliderRight;sliderRight.addEvent("mousedown",this.bound.start);_a=sliderRight.offsetWidth;}else{_a=0;}this.sliderRightWidth=_a;this.sliderLeftX=0;this.sliderRightX=0;_b=tb.getElement(".cp-fullrange");_b.addListener("mousedown",this.bound.start);this.fullrange=_b;if(_8!=1){_c=tb.getElement(".cp-selrange");_c.addListener("mousedown",this.bound.start);this.range=_c;}this.inputLeft=document.id(this.options.inputLeft);if(!_8){this.inputRight=document.id(this.options.inputRight);this.inputLeft.addListener("change",this.bound.set);this.inputRight.addListener("change",this.bound.set);}this.activePixels=w-_9-_a;this.rangeOfValues=this.options.limitRight-this.options.limitLeft;this.pixelsPerValue=this.activePixels/this.rangeOfValues;this.update();},start:function(_d){var p,_e,_f,_10,x,_11,_12,_13,_14;_d=new Event(_d);trackbarActive=true;_e=false;if(this.options.optimizeFPS==true){_f=getY(this.trackbarElement)-window.getScrollTop();this.trackbarElement.setProperty("style","position:fixed;width:"+this.trackbarWidth+"px;top:"+_f+"px;");}if(_d.target==this.fullrange){if(this.options.mode==1){this.slider=this.sliderLeft;this.startX=this.slider.getLeft()+this.sliderLeftWidth/2;_10=_d.page.x-this.startX;}else{_11=this.sliderLeft.getLeft();_13=_d.page.x;if(_13<_11){this.slider=this.sliderLeft;this.startX=_11+this.sliderLeftWidth/2;_10=_13-this.startX;}else{this.slider=this.sliderRight;this.startX=this.slider.getLeft()+this.sliderRightWidth/2;_10=_13-this.startX;}}_e=true;}else{if(_d.target==this.range){_11=this.sliderRight.getLeft();_12=this.sliderLeft.getLeft();_14=(_11+_12+this.sliderLeftWidth)/2;_13=_d.page.x;if(_13<_14){this.slider=this.sliderLeft;this.startX=_12+this.sliderLeftWidth/2;_10=_13-this.startX;}else{this.slider=this.sliderRight;this.startX=_11+this.sliderRightWidth/2;_10=_13-this.startX;}_e=true;}else{this.slider=_d.target;this.startX=_d.page.x;}}x=this.slider.offsetLeft;if(this.slider===this.sliderRight){x-=this.sliderRightWidth;}this.sliderPosX=(x>this.activePixels)?this.activePixels:x;document.addEvent("mousewheel",this.disableMouseWheel);if(window.addEventListener){window.addEventListener("DOMMouseScroll",this.disableMouseWheel,true);}document.addListener("mousemove",this.bound.drag);document.addListener("mouseup",this.bound.stop);if(this.options.label){this.labelValue=this.options.label.getElement(".cp-tb-label-value");}if(this.options.label){this.labelSubmitButton=this.options.label.getElement(".cp-tb-label-button");}_d.stop();if(_e){this.calcDrag(_10);}},drag:function(_15){_15=new Event(_15);var _16=_15.page.x-this.startX;this.calcDrag(_16);_15.stop();},calcDrag:function(_17){var v=((_17+this.sliderPosX)/this.activePixels)*this.rangeOfValues+this.options.limitLeft;v=v.toFixed(this.options.decimals).toFloat();if($defined(this.options.step)){v=v/this.options.step;v=Math.round(v)*this.options.step;}if(v<this.options.limitLeft){v=this.options.limitLeft;}if(v>this.options.limitRight){v=this.options.limitRight;}if(this.slider===this.sliderLeft){if(v==this.options.valueLeft||((v==this.options.valueLeft||this.options.valueLeft==null)&&v==this.options.limitLeft)){return;}}else{if(v==this.options.valueRight||((v==this.options.valueRight||this.options.valueRight==null)&&v==this.options.limitRight)){return;}}this.options.showApplyButton=true;if(this.slider===this.sliderRight){this.setValueRight(v);}else{this.setValueLeft(v);}},stop:function(_18){trackbarActive=false;_18=new Event(_18);var xy={custom:true,x:_18.page.x,y:_18.page.y};if(currentHoverParameter){currentHoverParameter.fireEvent("mouseleave",xy);}document.removeListener("mousemove",this.bound.drag);document.removeListener("mouseup",this.bound.stop);this.slider=null;this.trackbarElement.style.position="absolute";this.trackbarElement.style.top="";document.removeEvent("mousewheel",this.disableMouseWheel);if(window.removeEventListener){window.removeEventListener("DOMMouseScroll",this.disableMouseWheel,true);}},update:function(){this.setValueLeft(this.options.valueLeft);if(this.options.mode!=1){this.setValueRight(this.options.valueRight);}this.notSetLabel=false;},set:function(){var l=this.inputLeft.value.toInt();var r=this.inputRight.value.toInt();if(l){this.setValueLeft(l);}else{this.setValueLeft(this.options.limitLeft);}if(r){this.setValueRight(r);}else{this.setValueRight(this.options.limitRight);}},setValueLeft:function(v){var vr=this.options.valueRight,_19=this.options.delimeter,inp,rs,vrs,ll=null,lr=null;var r=this.checkValue(v,vr,this.options.limitLeft,"left");this.options.valueLeft=r;var _1a=this.options.mode;if(_1a==0){this.inputLeft.value=(r==null)?"":r;}else{if(_1a==1){rs=(r==null)?null:(this.options.values?this.options.values[r]:r);this.inputLeft.value=rs?rs:"";if(!this.notSetLabel){this.setLabel(rs,null);}}else{if(r==null||r==this.options.limitLeft){if(vr==null||vr==this.options.limitRight){inp="";}else{vrs=this.options.values?this.options.values[vr]:vr;inp=_19+vrs;lr=vrs;}}else{if(this.options.values){rs=this.options.values[r];vrs=this.options.values[vr];}else{rs=r;vrs=vr;}if(vr==null||vr==this.options.limitRight){if(r==this.options.limitRight){inp=rs+_19+rs;ll=lr=rs;}else{inp=rs+_19;ll=rs;}}else{inp=rs+_19+vrs;ll=rs;lr=vrs;}}this.inputLeft.value=inp;if(!this.notSetLabel){this.setLabel(ll,lr);}}}var w=this.width(r==null?0:(r-this.options.limitLeft));this.sliderLeft.setStyle("left",w+"px");this.sliderLeftX=w;if(_1a!=1){this.updateRangeWidth();}return this.options.valueLeft;},setValueRight:function(v){var vl=this.options.valueLeft,_1b=this.options.delimeter,inp,rs,vls,ll=null,lr=null;var r=this.checkValue(v,vl,this.options.limitRight,"right");this.options.valueRight=r;var _1c=this.options.mode;if(_1c==0){this.inputRight.value=(r==null)?"":r;}else{if(r==null||r==this.options.limitRight){if(vl==null||vl==this.options.limitLeft){inp="";}else{vls=this.options.values?this.options.values[vl]:vl;inp=vls+_1b;ll=vls;}}else{if(this.options.values){rs=this.options.values[r];vls=this.options.values[vl];}else{rs=r;vls=vl;}if(vl==null||vl==this.options.limitLeft){if(r==this.options.limitLeft){inp=rs+_1b+rs;ll=lr=rs;}else{inp=_1b+rs;lr=rs;}}else{inp=vls+_1b+rs;ll=vls;lr=rs;}}this.inputLeft.value=inp;if(!this.notSetLabel){this.setLabel(ll,lr);}}var w=this.width(r==null?0:(this.options.limitRight-r));this.sliderRight.setStyle("right",w+"px");this.sliderRightX=w;this.updateRangeWidth();return this.options.valueRight;},checkValue:function(v,_1d,e,_1e){l=this.options.limitLeft;r=this.options.limitRight;if(_1e=="left"){_1d=(_1d==null?r:_1d);v=(v==null?null:(v<l?l:(v<_1d?v:_1d)));}else{if(_1e=="right"){_1d=(_1d==null?l:_1d);v=(v==null?null:(v>r?r:(v>_1d?v:_1d)));}}return v==e&&this.options.extremumValueToNull?null:v;},width:function(_1f){var r=(this.pixelsPerValue)*_1f;return Math.round(r);},updateRangeWidth:function(){this.range.setStyles({left:this.sliderLeftX,right:this.sliderRightX});},setLabel:function(_20,_21){var _22=this.labelValue||this.options.label.getElement(".cp-tb-label-value"),_23=this.labelSubmitButton||this.options.label.getElement(".cp-tb-label-button"),opt=this.options,s="";if(opt.mode==1){if(_20){s+="<b>"+_20+"</b>";if(opt.infoLabels.units){s+=opt.infoLabels.units;}}else{s+=trackbarLabels.all;}}else{if(!_20){_20=opt.values?opt.values[opt.limitLeft]:opt.limitLeft;}if(!_21){_21=opt.values?opt.values[opt.limitRight]:opt.limitRight;}if(_20==_21){s+="<b>"+_20+"</b>";if(opt.infoLabels.units){s+=opt.infoLabels.units;}}else{s+="<b>"+_20+"</b> - <b>"+_21+"</b>";if(opt.infoLabels.units){s+=opt.infoLabels.units;}}}if(opt.showApplyButton){_23.removeClass("hid");}_22.innerHTML=s;},disableMouseWheel:function(_24){var e=new Event(_24);e.preventDefault();return false;}});cpTrackbar.implement(new Options);function getY(el){var top=0;do{top+=el.offsetTop||0;el=el.offsetParent;}while(el);return top;};function getParentElement(el,_25){do{if(el.className==_25){return el;}el=el.parentNode;}while(el);return null;};